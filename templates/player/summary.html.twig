{% import 'flags.html.twig' as flags %}
<div class="container">
    <h3>Facts:</h3>
    <div class="row mb-2">
        <div class="col">
            <table class="table table-striped table-sm">
                <tbody>
                    <tr>
                        <th scope="col">Race</th>
                        <td>{% include 'player/race.html.twig' with {'race': player.race, 'long': true} %}</td>
                    </tr>
                    {% if player.country %}
                    <tr>
                        <th scope="col">Country</th>
                        <td>{{ player.country }} {{ flags.getFlag(player.country) }}</td>
                    </tr>
                    {% endif %}
                    {% if player.name %}
                    <tr>
                        <th scope="col">Full Name</th>
                        <td>{{ player.name }}{% if player.romanizedName %} ({{ player.romanizedName}}){% endif %}</td>
                    </tr>
                    {% endif %}
                    {% if player.birthday %}
                    <tr>
                        <th scope="col">Birthday</th>
                        <td>{{ player.birthday|date('Y-m-d') }} <small>({{ player_age }} years)</small></td>
                    </tr>
                    {% endif %}
                    {% if player.lpName %}
                    <tr>
                        <th scope="col">Liquipedia</th>
                        <td><a href="https://liquipedia.net/starcraft2/{{ player.lpName }}">https://liquipedia.net/starcraft2/{{ player.lpName }}</a></td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        <div class="col">
            <table class="table table-striped table-sm">
                <tbody>
                    <tr>
                        <th scope="col">First Match</th>
                        <td>{{ results.first.date|date('Y-m-d') }}</td>
                    </tr>
                    <tr>
                        <th scope="col">Last Match</th>
                        <td>{{ results.last.date|date('Y-m-d') }}</td>
                    </tr>
                    <tr>
                        <th scope="col">Total earnings</th>
                        <td>${{ total_earnings|number_format(0, "", ",") }}</td>
                    </tr>
                    <tr>
                        <th scope="col">Matches/Map played</th>
                        <td>{{ results.total_matches }} / {{ results.total_maps }}</td>
                    </tr>
                    <tr>
                        <th scope="col">Winrate Matches/Maps</th>
                        <td>
                            {{ (100 * results.match_wins / results.total_matches)|round(1, 'floor') }}%
                            /
                            {{ (100 * results.map_wins / results.total_maps)|round(1, 'floor') }}%
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div id="chart" class="container mb-2"></div>
    <h3>Most recent results:</h3>
    {% include 'player/matches.html.twig' with {'matches': results.recent_matches, 'events': false} %}
</div>
<script>
    $(document).ready(function() {
        var myChart = Highcharts.chart('chart', {
            chart: {type: 'line'},
            title: {text: 'Number of matches each month'},
            plotOptions: {
                column: {
                    pointStart: Date.UTC({{ results.last.date|date('Y, m, d') }})
                },
                series: {
                    animation: false
                },
            },
            xAxis: {
                type: 'datetime',
            },
            yAxis: {
                title: "",
                gridLineWidth: 1,
            },
            series: [
                {
                    name: "Matches",
                    color: 'rgba(0, 0, 0, 0.5)',
                    borderWidth: 0,
                    enableMouseTracking: true,
                    type: 'column',
                    tooltip: {
                        pointFormat: 'score: {point.wins} - {point.losses}',
                    },
                    data: [
                        {% for timestamp, data in results.matches_month %}
                        {
                            x:{{ timestamp}},
                            y:{{ data.total_matches }},
                            wins: {{ data.total_wins }},
                            losses: {{ data.total_matches - data.total_wins }},
                            {% if data.total_matches > 0 %}
                            color: 'rgba(20, 20, 20, {{ 0.1 + (((data.total_wins)/(2*data.total_matches))|round(1, 'floor'))*2 }})',
                            {% endif %}
                        },
                        {% endfor %}
                    ],
                },
            ],
            credits: {enabled: false},
        });
    });
</script>
